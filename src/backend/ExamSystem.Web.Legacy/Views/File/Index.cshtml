@using Microsoft.AspNetCore.Mvc.TagHelpers
@{
    ViewData["Title"] = "File Upload";
}

@section Styles {
    <!-- Dropzone CSS -->
        <link href="~/lib/dropzone/dropzone.css" rel="stylesheet" />
    <style>
        .dropzone {
            border: 2px dashed #007bff;
            border-radius: 10px;
            background: #f8f9fa;
            padding: 20px;
        }
    </style>
}

<div class="container mt-5">
    <div class="upload-content">
        <form asp-action="Upload" asp-controller="File" asp-antiforgery="true" class="dropzone" id="my-great-dropzone">
            <div class="fallback">
                <input name="file" type="file" />
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <!-- Dropzone JS -->
    <script src="~/lib/dropzone/dropzone.js"></script>
    <script>
        Dropzone.options.myGreatDropzone = {
            paramName: "file",
            maxFilesize: 10,
            maxFiles: 3,
            addRemoveLinks: true,
            dictRemoveFile: '✖',
            init: function () {
                const dropzone = this;

                this.on("success", function (file, response) {
                    console.log(response);
                });

                this.on("error", function (file, response) {
                    console.error(response);
                });

                this.on("removedfile", function (file) {
                    const filename = file.name;
                    $.ajax({
                        url: '@Url.Action("Delete", "File")', 
                        type: 'POST',
                        data: { FileName: filename },
                        success: function (response) {
                            console.log("File removed: ", filename);
                        },
                        error: function (xhr, status, error) {
                            console.error("Error removing file: ", error);
                        }
                    });
                });
            }
        };
    </script>
}
